"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_react=require("react"),_react2=_interopRequireDefault(_react),_classnames=require("classnames"),_classnames2=_interopRequireDefault(_classnames),_isEqual=require("lodash/isEqual"),_isEqual2=_interopRequireDefault(_isEqual),_isFunction=require("lodash/isFunction"),_isFunction2=_interopRequireDefault(_isFunction),_reactClickOutside=require("react-click-outside"),_reactClickOutside2=_interopRequireDefault(_reactClickOutside),_SelectionArrow=require("./SelectionArrow"),_SelectionArrow2=_interopRequireDefault(_SelectionArrow),_SelectDropdown=require("./SelectDropdown"),_SelectDropdown2=_interopRequireDefault(_SelectDropdown),_SelectSelection=require("./SelectSelection"),_SelectSelection2=_interopRequireDefault(_SelectSelection),Select=function(e){function t(e,r){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r));_initialiseProps.call(n);var o=e.value,i=e.data,a=e.disabled;if(!Array.isArray(i))throw new Error("Provided data prop is invalid. Expected an array of option items");if(o&&"number"==typeof o&&"string"==typeof o)throw new Error("Provided value prop is invalid. Expected option id or option text");return n._initialData=i,n._initialState={value:o,data:n.getOptionsData(i),disabled:a,highlighted:null,dropdownOpened:!1,searchShow:!1},n.state=Object.assign({},n._initialState),n}return _inherits(t,e),_createClass(t,[{key:"componentWillReceiveProps",value:function(e){var t=e.data,r=e.disabled,n=e.value,o=Object.assign({},this._initialState,{value:this.state.value}),i=!1;r!==this.state.disabled&&(o.disabled=r,i=!0),t!==this._initialData&&(this._initialData=t,o.data=this.getOptionsData(t),i=!0),!n&&null!==n||n===this.state.value||(o.value=n,i=!0),i&&this.setState(o)}},{key:"render",value:function(){var e=this.props,t=e.error,r=e.options,n=e.dropdownPosition,o=this.state,i=o.data,a=o.disabled,l=o.dropdownOpened,s=o.highlighted,c=o.value,p=(0,_classnames2.default)("select react-select-container react-select-container--default",{"react-select-container--open":l,"react-select-container--disabled":a,"react-select-container--error":t,"react-select-container--above":"above"===n,"react-select-container--below":!n||"below"===n});return _react2.default.createElement("span",{className:p,style:{width:r.width||"245px"},disabled:a},_react2.default.createElement("span",{ref:"selectContainer",className:"react-select__selection react-select-selection--single",tabIndex:"1",disabled:a,onClick:this.onContainerClick,onKeyDown:this.onContainerKeyDown,role:"combobox"},_react2.default.createElement(_SelectSelection2.default,{data:i,value:c,placeholder:r.placeholder}),_react2.default.createElement(_SelectionArrow2.default,null)),l&&_react2.default.createElement(_SelectDropdown2.default,_extends({searchShow:i.length>=r.minimumResultsForSearch||r.ajax,onSelect:this.onSelectOption},{data:i,highlighted:s})))}}]),t}(_react.Component);Select.propTypes={data:_react.PropTypes.oneOfType([_react.PropTypes.arrayOf(_react.PropTypes.string),_react.PropTypes.arrayOf(_react.PropTypes.shape({id:_react.PropTypes.oneOfType([_react.PropTypes.number,_react.PropTypes.string]),text:_react.PropTypes.oneOfType([_react.PropTypes.number,_react.PropTypes.string])}))]),dropdownPosition:_react.PropTypes.oneOf(["above","below"]),ajax:_react.PropTypes.object,options:_react.PropTypes.shape({placeholder:_react.PropTypes.oneOfType([_react.PropTypes.string,_react.PropTypes.element]),width:_react.PropTypes.string,minimumResultsForSearch:_react.PropTypes.number}),error:_react.PropTypes.oneOfType([_react.PropTypes.bool,_react.PropTypes.string]),disabled:_react.PropTypes.bool,name:_react.PropTypes.string,onSelect:_react.PropTypes.func,value:_react.PropTypes.oneOfType([_react.PropTypes.string,_react.PropTypes.number])},Select.defaultProps={options:{}};var _initialiseProps=function(){var e=this;this.shouldComponentUpdate=function(t,r){var n=t.data,o=t.disabled,i=t.value;return n!==e._initialData||o!==e.state.disabled||i!==e.state.value||!(0,_isEqual2.default)(r,e.state)},this.getOptionsData=function(t){if(!t.length)return[];if(t.reduce(function(e,t){return e&&"undefined"!=typeof t.id&&"undefined"!=typeof t.text},!0))return t;if(t.reduce(function(e,t){return e&&("number"==typeof t||"string"==typeof t)},!0))return t.map(function(e){return{id:e,text:e}});throw e.exceptions.invalidDataProvided},this.getOptionByIndex=function(t){var r=e.state.data;if(t>r.length||t<0)throw new Error("Invalid index provided");return r[t]},this.focusContainer=function(){var t=window.scrollX,r=window.scrollY;e.refs.selectContainer.focus(),window.scrollTo(t,r)},this.onContainerClick=function(){return e.state.disabled?void e.setState({dropdownOpened:!1}):void e.setState({dropdownOpened:!e.state.dropdownOpened})},this.setHightlightedOption=function(t){var r=e.state,n=r.data,o=r.highlighted,i=r.dropdownOpened,a=n.length-1,l=o+t;return!i||null===o||l>a?void e.setState({highlighted:0,dropdownOpened:!0}):l<0?void e.setState({highlighted:a}):void e.setState({highlighted:l})},this.selectHighlighted=function(){var t=e.state,r=t.data,n=t.highlighted,o=t.dropdownOpened;return o&&null!==n?void e.onSelect(r[n]):void e.setState({dropdownOpened:!0,highlighted:0})},this.onContainerKeyDown=function(t){var r={ArrowUp:e.setHightlightedOption.bind(null,-1),ArrowDown:e.setHightlightedOption.bind(null,1),Enter:e.selectHighlighted," ":e.selectHighlighted,Escape:e.closeDropdown},n=t.key;r[n]&&(t.preventDefault(),r[n]())},this.handleClickOutside=function(){e.closeDropdown()},this.closeDropdown=function(){e.setState({dropdownOpened:!1,highlighted:null})},this.onSelect=function(t){var r=e.props,n=r.name,o=r.onSelect,i={type:"select",target:{name:n,value:t.id,valueText:t.text}};e.setState({value:t.id}),(0,_isFunction2.default)(o)&&o(i),e.closeDropdown(),e.focusContainer()},this.onSelectOption=function(t){var r=t.target.dataset.index,n=e.getOptionByIndex(r);e.onSelect(n)}};exports.default=(0,_reactClickOutside2.default)(Select);